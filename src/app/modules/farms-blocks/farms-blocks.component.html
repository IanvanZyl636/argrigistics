<ng-container *ngIf="farmsBlocks$ | async as po">
  <div class="flex flex-row mb-6">
    <div>
      <h1 class="h1-header">Farms and Blocks</h1>
      <h2 class="h2-header">Manage farms and blocks and sub-blocks.</h2>
    </div>
    <div class="ml-auto flex flex-col justify-center align-middle">
      <div>
        <button class="mr-4" mat-raised-button color="primary">Add Farm</button>
        <button mat-stroked-button color="primary">Add Block</button>
      </div>
    </div>
  </div>
  <div class="flex flex-row align-middle bar-section p-4 mb-1">
    <div class="the-dense-zone">
      <mat-form-field class="mr-4" appearance="outline">
        <fa-icon
          class="ml-4 txt-grey"
          matTextSuffix
          [icon]="faCaretDown"
        ></fa-icon>
        <mat-label class="input-placeholder">Select or type a farm</mat-label>
        <mat-label class="input-label">Farm</mat-label>
        <input
          type="text"
          placeholder="Select or type a farm"
          aria-label="Number"
          matInput
          [(ngModel)]="filterFarmText"
          [matAutocomplete]="auto"
        />
        <mat-autocomplete
          #auto="matAutocomplete"
          (optionSelected)="selectedFarm = $event.option.value"
        >
          <mat-option *ngFor="let option of filterdFarmNames" [value]="option">
            {{ option }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field class="mr-4" appearance="outline">
        <fa-icon
          class="mr-4 txt-grey"
          matTextPrefix
          [icon]="faMagnifyingGlass"
        ></fa-icon>
        <mat-label class="input-placeholder">Search Columns</mat-label>
        <mat-label class="input-label">Search</mat-label>
        <input
          matInput
          placeholder="Search Columns"
          [formControl]="searchFarmFormControl"
          [ngModel]="searchedFarmBlock"
        />
      </mat-form-field>
      <ng-container *ngIf="(searchFarmBlock$ | async) && searchedFarmBlock">
        <mat-chip [highlighted]="true" (removed)="searchedFarmBlock = ''">
          {{ searchedFarmBlock }}
          <button class="text-white" matChipRemove [attr.aria-label]="'remove'">
            <fa-icon [icon]="faTimesCircle"></fa-icon>
          </button>
        </mat-chip>
      </ng-container>
    </div>

    <div class="ml-auto flex flex-col justify-center align-middle">
      <div>
        <mat-slide-toggle
          class="mr-4"
          [hideIcon]="true"
          [(ngModel)]="removedBlockToggle"
        ></mat-slide-toggle>
        <span class="txt-grey">Removed blocks</span>
      </div>
    </div>
  </div>
  <ng-container *ngIf="filterdFarmsBlocks as farmsBlocksFilterd">
    <table class="table-theme w-full table-auto border-collapse">
      <thead class="border-b">
        <tr>
          <th class="text-left">Status</th>
          <th class="text-left">Block</th>
          <th class="text-left">Farm</th>
          <th class="text-left">Variant</th>
          <th class="text-left">Ha</th>
          <th class="text-left">Create</th>
          <th class="text-left">Removed</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="farmsBlocksFilterd.length <= 0">
          <tr>
            <td>No data</td>
          </tr>
        </ng-container>
        <ng-container *ngIf="farmsBlocksFilterd.length > 0">
          <tr class="border-b border-t" *ngFor="let item of farmsBlocksFilterd">
            <td class="text-left" [innerHTML]="item.status | farmStatus"></td>
            <td class="text-left">{{ item.name }}</td>
            <td class="text-left">{{ item.farmName }}</td>
            <td class="text-left">{{ item.variant }}</td>
            <td class="text-left">{{ item.size | number : '1.0-2' }}</td>
            <td class="text-left">{{ item.createdAt | date : 'd/M/yyyy' }}</td>
            <td class="text-left">{{ item.deletedAt | date : 'd/M/yyyy' }}</td>
          </tr>
        </ng-container>
        <tr class="border-t border-b">
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>{{ sumHa(farmsBlocksFilterd) | number : '1.0-2' }}</td>
          <td></td>
          <td></td>
        </tr>
      </tbody>
    </table>
    <mat-paginator
      [length]="farmsBlocksFilterd.length"
      [pageSize]="50"
      [pageSizeOptions]="[10, 50, 100]"
      aria-label="Select page"
    >
    </mat-paginator>
  </ng-container>
</ng-container>
